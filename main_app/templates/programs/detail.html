{% extends 'base.html' %}
{% block content %}

<div class="progdetail-container">
  <div class="progdetail-header">
    <div class="progdetail-title-section">
      <h1 class="progdetail-name">{{ program.name }}</h1>
      <span class="progdetail-level">{{ program.level }}</span>
    </div>
    
    <div class="progdetail-info-grid">
      <div class="progdetail-info-left">
        <div class="progdetail-info-item">
          <span class="progdetail-label">Language</span>
          <span class="progdetail-value">{{ program.language }}</span>
        </div>
        <div class="progdetail-info-item">
          <span class="progdetail-label">Duration</span>
          <span class="progdetail-value">{{ program.duration }} years</span>
        </div>
        <div class="progdetail-info-item">
          <span class="progdetail-label">Description</span>
          <div class="progdetail-description">
            <span class="progdetail-value">{{ program.description }}</span>
          </div>
        </div>
        
        <div class="progdetail-resources">
          <span class="progdetail-label">Resources</span>
          <div class="progdetail-resource-icons">
            <a href="{{ program.resources_link }}" class="progdetail-resource-icon">üåê</a>
          </div>
        </div>
      </div>
      
      <div class="progdetail-info-right">
        <div class="progdetail-requirements">
          <span class="progdetail-label">Requirements</span>
            <div class="progdetail-description">
            <span class="progdetail-value">{{ program.requirements }}</span>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="progdetail-questions-section">
    <h3 class="progdetail-section-title">Questions</h3>
    
    {% for question in questions %}
      <div class="progdetail-question-card">
        <div class="progdetail-question-header">
          <span class="progdetail-username">{{ question.user.username }}</span>
          <div class="progdetail-question-actions">
            {% if request.user == question.user %}
              <button onclick="toggleEdit({{ question.id }})" class="progdetail-edit-btn">‚úèÔ∏è</button>
              <form method="post" action="{% url 'question_delete' question.id %}" class="progdetail-delete-form">
                {% csrf_token %}
                <button type="submit" class="progdetail-delete-btn">üóëÔ∏è</button>
              </form>
            {% endif %}
          </div>
        </div>
        
        <div id="question-view-{{ question.id }}" class="progdetail-question-content">
          <p class="progdetail-question-text">{{ question.question_txt }}</p>
        </div>
        
        <div id="question-edit-{{ question.id }}" class="progdetail-question-edit" style="display:none;">
          <form method="post" class="progdetail-edit-form">
            {% csrf_token %}
            <input type="hidden" name="question_id" value="{{ question.id }}">
            <input type="text" name="question_txt" value="{{ question.question_txt }}" 
                  class="progdetail-edit-input" required>
            <div class="progdetail-edit-actions">
              <button type="submit" name="edit_question" class="progdetail-save-btn">üíæ Save</button>
              <button type="button" onclick="toggleEdit({{ question.id }})" class="progdetail-cancel-btn">üóëÔ∏è</button>
            </div>
          </form>
        </div>
        
        <div class="progdetail-answers-section">
          {% for answer in question.answers.all %}
            <div class="progdetail-answer">
              <span class="progdetail-answer-user">{{ answer.user.username }}</span>
              <span class="progdetail-answer-text">{{ answer.answer_txt }}</span>
              {% if request.user == answer.user %}
                <form method="post" action="{% url 'answer_delete' answer.id %}" class="progdetail-answer-delete">
                  {% csrf_token %}
                  <button type="submit" class="progdetail-delete-btn">üóëÔ∏è</button>
                </form>
              {% endif %}
            </div>
          {% empty %}
            <p class="progdetail-no-answers">No answers yet.</p>
          {% endfor %}
          
          <form method="post" class="progdetail-answer-form">
            {% csrf_token %}
            <input type="text" name="answer_txt" placeholder="..........................." 
            class="progdetail-answer-input" required>
            <input type="hidden" name="question_id" value="{{ question.id }}">
            <button type="submit" name="add_answer" class="progdetail-reply-btn">‚Ü©Ô∏è Reply</button>
            <button type="button" class="progdetail-answer-delete-btn">üóëÔ∏è </button>
          </form>
        </div>
      </div>
    {% empty %}
      <p class="progdetail-no-questions">No questions yet for this program.</p>
    {% endfor %}
  </div>

  <div class="progdetail-add-question-section">
    <h3 class="progdetail-section-title">Add a Question</h3>
    <form method="post" class="progdetail-add-question-form">
      {% csrf_token %}
      <input type="text" name="question_txt" placeholder="Add your question ............" 
      class="progdetail-add-input" required>
      <button type="submit" name="add_question" class="progdetail-add-btn">ADD</button>
    </form>
  </div>
</div>

<script>
const toggleEdit = (id) => {
  const viewDiv = document.getElementById(`question-view-${id}`);
  const editDiv = document.getElementById(`question-edit-${id}`);
  if (viewDiv.style.display === "none") {
    viewDiv.style.display = "block";
    editDiv.style.display = "none";
  } else {
    viewDiv.style.display = "none";
    editDiv.style.display = "block";
  }
}
</script>

{% endblock %}